{"ast":null,"code":"import _classCallCheck from \"/Users/apple/Documents/AccessControlSoft/accesscontrolsoft/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/apple/Documents/AccessControlSoft/accesscontrolsoft/node_modules/@babel/runtime/helpers/esm/createClass.js\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nimport { Component, ViewChild } from '@angular/core';\nimport { FormBuilder, Validators } from '@angular/forms';\nimport { Router } from '@angular/router';\nimport { Menssage } from 'src/app/models/router';\nimport { AlertService } from 'src/app/service/alert.service';\nimport { AuthService } from 'src/app/service/auth.service';\nimport { LocalstoreService } from 'src/app/service/localstore.service';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatSort } from '@angular/material/sort';\nimport { MatTableDataSource } from '@angular/material/table';\nimport Swal from 'sweetalert2';\n\nvar LogBooksComponent = /*#__PURE__*/function () {\n  function LogBooksComponent(localStore, _https, router, formBuilder, alert) {\n    _classCallCheck(this, LogBooksComponent);\n\n    this.localStore = localStore;\n    this._https = _https;\n    this.router = router;\n    this.formBuilder = formBuilder;\n    this.alert = alert;\n    this.eventList = [];\n    this.calendarVisible = false;\n    this.eventsData = [];\n    this.customerDetail = [];\n    this.images = [];\n    this.eventItems = [];\n    this.needRefresh = false;\n    this.displayedColumns = ['id', 'name', 'direction', 'telephone', 'identification', 'email', 'type', 'accion'];\n    this.usersData = this.localStore.getSuccessLogin();\n    this.customerDetail = this.localStore.getItem(Menssage.customerDetail);\n    this.getEvents(this.usersData.user.idProyectsClients); //this.getEventImg(this.usersData.user.idProyectsClients, '')\n  }\n\n  _createClass(LogBooksComponent, [{\n    key: \"ngOnInit\",\n    value: function ngOnInit() {\n      this.initial();\n    }\n  }, {\n    key: \"initial\",\n    value: function initial() {\n      /* if (localStorage.getItem('token') !== null) {\n        this.router.navigate([RoutersLink.home]);\n      } */\n      this.form = this.formBuilder.group({\n        nameProjectsClients: [Menssage.empty, Validators.compose([Validators.required])],\n        addressProjectsClients: [Menssage.empty, Validators.compose([Validators.required])],\n        telephoneProjectsClients: [Menssage.empty, Validators.compose([Validators.required])],\n        identificationCardProjectsClients: [Menssage.empty, Validators.compose([Validators.required])],\n        emailProjectsClients: [Menssage.empty, Validators.compose([Validators.required, Validators.pattern(Menssage.valiEmail), Validators.minLength(5)])],\n        idUsers: [this.usersData.user.id, Validators.compose([Validators.required])]\n      });\n    }\n  }, {\n    key: \"applyFilter\",\n    value: function applyFilter(event) {\n      var filterValue = event.target.value;\n      this.dataSource.filter = filterValue.trim().toLowerCase();\n\n      if (this.dataSource.paginator) {\n        this.dataSource.paginator.firstPage();\n      }\n    }\n  }, {\n    key: \"getEvents\",\n    value: function getEvents(item) {\n      var _this = this;\n\n      this.alert.loading();\n\n      this._https.getEvent(item).then(function (resulta) {\n        console.log(resulta);\n        _this.eventItems = resulta;\n\n        _this.alert.messagefin();\n\n        _this.eventsData = [];\n        resulta.forEach(function (element) {\n          _this.eventsData.push({\n            id: element.id,\n            name: element.nameProjectsClients,\n            direction: element.addressProjectsClients,\n            telephone: element.telephoneProjectsClients,\n            identification: element.identificationCardProjectsClients,\n            email: element.emailProjectsClients,\n            idProyectsClients: element.id,\n            type: element.userMaster\n          });\n        });\n        _this.dataSource = new MatTableDataSource(_this.eventsData);\n        _this.dataSource.paginator = _this.paginator;\n        _this.dataSource.sort = _this.sort;\n        console.log(_this.eventsData);\n      }).catch(function (err) {\n        console.log(err.error);\n\n        if (err.error.message != undefined) {\n          _this._https.logout();\n        }\n\n        _this.alert.error(Menssage.error, Menssage.server);\n      });\n    }\n  }, {\n    key: \"valid\",\n    value: function valid(item) {\n      var valid = true;\n\n      if (item.zode === Menssage.empty) {\n        this.alert.error(Menssage.error, Menssage.zode);\n        valid = false;\n      }\n\n      if (item.daneMunicipality === Menssage.empty) {\n        this.alert.error(Menssage.error, Menssage.daneMunicipality);\n        valid = false;\n      }\n\n      if (item.municipality === Menssage.empty) {\n        this.alert.error(Menssage.error, Menssage.municipality);\n        valid = false;\n      }\n\n      if (item.daneInstitutions === Menssage.empty) {\n        this.alert.error(Menssage.error, Menssage.daneInstitutions);\n        valid = false;\n      }\n\n      if (item.institutions === Menssage.empty) {\n        this.alert.error(Menssage.error, Menssage.institutions);\n        valid = false;\n      }\n\n      if (item.direction === Menssage.empty) {\n        this.alert.error(Menssage.error, Menssage.direction);\n        valid = false;\n      }\n\n      if (item.rector === Menssage.empty) {\n        this.alert.error(Menssage.error, Menssage.rector);\n        valid = false;\n      }\n\n      if (item.telephone === Menssage.empty) {\n        this.alert.error(Menssage.error, Menssage.telephone);\n        valid = false;\n      }\n\n      if (item.email === Menssage.empty) {\n        this.alert.error(Menssage.error, Menssage.email);\n        valid = false;\n      }\n\n      if (item.idusers === Menssage.empty) {\n        this.alert.error(Menssage.error, Menssage.idusers);\n        valid = false;\n      }\n\n      if (item.idProyectsClients === Menssage.empty) {\n        this.alert.error(Menssage.error, Menssage.idProyectsClients);\n        valid = false;\n      }\n\n      return valid;\n    }\n  }, {\n    key: \"getEventImg\",\n    value: function getEventImg(item, itenEvents) {\n      var _this2 = this;\n\n      this._https.getEventImg(item, itenEvents).then(function (resulta) {\n        console.log(resulta);\n        var count = 1;\n        _this2.eventsData = [];\n        resulta.forEach(function (element) {\n          _this2.eventsData.push({\n            id: count++,\n            idEvents: element.id,\n            nameEvent: element.nameEvent,\n            companyNameEvent: element.companyNameEvent,\n            nitEvent: element.nitEvent,\n            dateEvent: element.dateEvent,\n            imgEvent: element.imgEvent\n          });\n        });\n        _this2.dataSource = new MatTableDataSource(_this2.eventsData);\n        _this2.dataSource.paginator = _this2.paginator;\n        _this2.dataSource.sort = _this2.sort;\n      }).catch(function (err) {\n        console.log(err);\n\n        _this2.alert.error(Menssage.error, Menssage.server);\n      });\n    }\n  }, {\n    key: \"getFileDetails\",\n    value: function getFileDetails(event) {\n      var file = event.target.files[0];\n      var reader = new FileReader();\n      reader.readAsDataURL(file);\n\n      reader.onload = function () {\n        file.dataURL = reader.result;\n      };\n\n      this.form.controls['imgInstitutions'].setValue(file);\n    }\n  }, {\n    key: \"deleteList\",\n    value: function deleteList(id) {\n      var _this3 = this;\n\n      Swal.fire({\n        title: 'Estas seguro de suspender este cliente',\n        icon: 'info',\n        showDenyButton: true,\n        showCancelButton: false,\n        confirmButtonText: 'Si',\n        denyButtonText: 'No',\n        customClass: {\n          actions: 'my-actions',\n          cancelButton: 'order-1 right-gap',\n          confirmButton: 'order-2',\n          denyButton: 'order-3'\n        }\n      }).then(function (result) {\n        if (result.isConfirmed) {\n          _this3.deleteFull(id);\n        } else if (result.isDenied) {\n          _this3.alert.error(Menssage.error, \"Cancelo la suspenci√≥n del cliente\");\n        }\n      });\n    }\n  }, {\n    key: \"deleteFull\",\n    value: function deleteFull(id) {\n      var _this4 = this;\n\n      this.alert.loading();\n\n      this._https.updateUsersClient(id).then(function (resulta) {\n        _this4.alert.success(Menssage.exito, Menssage.successDelete);\n\n        _this4.getEvents(_this4.usersData.user.idProyectsClients);\n      }).catch(function (err) {\n        console.log(err);\n\n        _this4.alert.error(Menssage.error, Menssage.server);\n      });\n    }\n  }, {\n    key: \"resgisterImageEvents\",\n    value: function resgisterImageEvents() {\n      var _this5 = this;\n\n      if (this.images.length != 0) {\n        this.alert.loading();\n        var data = {\n          img: this.images,\n          idEvent: this.selectItems,\n          idUsers: this.usersData.user.id,\n          idProyectsClients: this.usersData.user.idProyectsClients\n        };\n\n        this._https.resgisterImageEvents(data).then(function (resulta) {\n          _this5.alert.success(Menssage.exito, Menssage.successDelete);\n\n          _this5.getEventImg(_this5.usersData.user.idProyectsClients, '');\n\n          _this5.images = [];\n        }).catch(function (err) {\n          console.log(err.error);\n\n          if (err.error.message != undefined) {\n            _this5._https.logout();\n          }\n\n          _this5.alert.error(Menssage.error, Menssage.server);\n        });\n      } else {\n        this.alert.error(Menssage.error, Menssage.idImg);\n      }\n    }\n  }, {\n    key: \"onSubmit\",\n    value: function onSubmit(item) {\n      var _this6 = this;\n\n      console.log(item);\n\n      if (this.valid(item)) {\n        this.alert.loading();\n\n        this._https.createInstitution(item).then(function (resulta) {\n          _this6.cleanReset();\n        }).catch(function (err) {\n          console.log(err);\n\n          if (err.error.message != undefined) {\n            _this6._https.logout();\n          }\n\n          _this6.alert.error(Menssage.error, Menssage.server);\n        });\n      }\n    }\n  }, {\n    key: \"cleanReset\",\n    value: function cleanReset() {\n      this.form.reset();\n      this.form.controls['idusers'].setValue(this.usersData.user.id);\n      this.getEvents(this.usersData.user.idProyectsClients);\n    }\n  }, {\n    key: \"routeList\",\n    value: function routeList(id) {\n      var code = btoa(id);\n      this.router.navigate(['/home/createClients/listUsers/' + code]);\n    }\n  }]);\n\n  return LogBooksComponent;\n}();\n\n__decorate([ViewChild(MatPaginator), __metadata(\"design:type\", MatPaginator)], LogBooksComponent.prototype, \"paginator\", void 0);\n\n__decorate([ViewChild(MatSort), __metadata(\"design:type\", MatSort)], LogBooksComponent.prototype, \"sort\", void 0);\n\nLogBooksComponent = __decorate([Component({\n  selector: 'app-log-books',\n  templateUrl: './log-books.component.html',\n  styleUrls: ['./log-books.component.css']\n}), __metadata(\"design:paramtypes\", [LocalstoreService, AuthService, Router, FormBuilder, AlertService])], LogBooksComponent);\nexport { LogBooksComponent };","map":null,"metadata":{},"sourceType":"module"}